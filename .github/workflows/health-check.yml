name: åŸŸåå¥åº·æ£€æŸ¥

on:
  schedule:
    - cron: '0 */12 * * *'  # æ¯12å°æ—¶è¿è¡Œä¸€æ¬¡
  workflow_dispatch:  # æ”¯æŒæ‰‹åŠ¨è§¦å‘

jobs:
  health-check:
    # æ·»åŠ ä»“åº“æ£€æŸ¥ï¼Œç¡®ä¿åªåœ¨ä¸»ä»“åº“è¿è¡Œ
    if: github.repository == 'bestzwei/LibreDomains'
    runs-on: ubuntu-latest
    permissions:
      contents: read
      actions: read
    steps:
      - name: æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
        
      - name: è®¾ç½® Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'
          cache: 'pip'
          
      - name: å®‰è£…ä¾èµ–
        run: pip install requests dnspython
        
      - name: è¿è¡ŒåŸŸåå¥åº·æ£€æŸ¥
        run: |
          # è®¾ç½® Python è·¯å¾„ä»¥ä¾¿æ­£ç¡®å¯¼å…¥æ¨¡å—
          export PYTHONPATH=$PYTHONPATH:$(pwd)
          
          echo "ğŸš€ å¼€å§‹åŸŸåå¥åº·æ£€æŸ¥..."
          echo "ğŸ“… æ£€æŸ¥æ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S UTC')"
          echo "ğŸ”§ è§¦å‘æ–¹å¼: ${{ github.event_name }}"
          echo "ğŸ“ ä»“åº“: ${{ github.repository }}"
          echo ""
          
          # è¿è¡Œå¥åº·æ£€æŸ¥ï¼Œåªæ˜¾ç¤ºæ‘˜è¦ä¿¡æ¯
          if python scripts/health/domain_health.py --summary-only; then
            echo ""
            echo "âœ… åŸŸåå¥åº·æ£€æŸ¥å®Œæˆ"
            exit 0
          else
            echo ""
            echo "âš ï¸ å‘ç°åŸŸåå¥åº·é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ä¸Šæ–¹è¯¦ç»†ä¿¡æ¯"
            echo "ğŸ’¡ æç¤º: å¯ä»¥æ‰‹åŠ¨è¿è¡Œæ£€æŸ¥è·å–æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼š"
            echo "   python scripts/health/domain_health.py"
            exit 1
          fi
        
      - name: æ£€æŸ¥å¤±è´¥é€šçŸ¥
        if: failure()
        run: |
          echo "âŒ åŸŸåå¥åº·æ£€æŸ¥å¤±è´¥"
          echo "ğŸ“‹ å¯èƒ½çš„åŸå› :"
          echo "  1. DNS è§£æé—®é¢˜"
          echo "  2. ç½‘ç»œè¿æ¥é—®é¢˜" 
          echo "  3. åŸŸåé…ç½®é”™è¯¯"
          echo "  4. æœåŠ¡å™¨å“åº”è¶…æ—¶"
          echo ""
          echo "ğŸ”§ å»ºè®®æ“ä½œ:"
          echo "  1. æ£€æŸ¥åŸŸåé…ç½®æ–‡ä»¶"
          echo "  2. éªŒè¯ DNS è®°å½•è®¾ç½®"
          echo "  3. æ‰‹åŠ¨è¿è¡Œå¥åº·æ£€æŸ¥è„šæœ¬è¿›è¡Œè°ƒè¯•"
          
      - name: Fork ä»“åº“æç¤º
        if: github.repository != 'bestzwei/LibreDomains'
        run: |
          echo "â„¹ï¸ æ­¤å·¥ä½œæµä»…åœ¨ä¸»ä»“åº“ bestzwei/LibreDomains ä¸­è¿è¡Œ"
          echo "ğŸ“ Fork ä»“åº“æ— éœ€è¿è¡ŒåŸŸåå¥åº·æ£€æŸ¥"
          echo "ğŸ” å¦‚éœ€æµ‹è¯•åŸŸåé…ç½®ï¼Œè¯·ä½¿ç”¨éªŒè¯è„šæœ¬ï¼š"
          echo "   python scripts/health/domain_health.py --help"
